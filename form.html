<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Student Registration</title>
  <style>
    :root{ --gap:12px; --label-width:110px; --err:#b00020 }
    body{ font-family: system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; padding:24px; color:#111 }
    h1{ margin:0 0 18px 0; font-size:20px }
    form{ max-width:640px; background:#fff; padding:16px; border:1px solid #ddd; border-radius:6px }
    .row{ display:flex; gap:var(--gap); align-items:flex-start; margin-bottom:15px }
    .row .form-group{ flex:1; display:flex; flex-direction:column; gap:4px }
    label{ width:var(--label-width); font-weight:600; flex-shrink:0 }
    input[type="text"], input[type="email"], select{ flex:1; padding:6px 8px; border:1px solid #bbb; border-radius:4px; width:100% }
    .small{ max-width:160px }
    .form-group .small{ width:auto; flex:none }
    .error{ color:var(--err); font-size:12px; margin:0 }
    .actions{ display:flex; gap:10px; margin-top:14px }
    .actions button{ padding:8px 12px; border-radius:4px; border:1px solid #888; background:#f3f3f3; cursor:pointer }
    .actions button.primary{ background:#2b7cff; color:#fff; border-color:#1f5fd6 }
    .note{ margin-top:8px; font-size:13px; color:#444 }
    @media (max-width:520px){ label{ width:100px } .row{ flex-direction:column; align-items:flex-start } }
  </style>
</head>
<body>
  <h1>Student Registration</h1>
  <form id="student-form" novalidate>
    <div class="row">
      <label for="sid">Student ID</label>
      <div class="form-group">
        <input id="sid" name="sid" type="text" inputmode="numeric" pattern="\d+" maxlength="10" class="small" required aria-describedby="sid-error">
        <span id="sid-error" class="error" aria-live="polite"></span>
      </div>
    </div>

    <div class="row">
      <label for="lastName">Last name</label>
      <div class="form-group">
        <input id="lastName" name="lastName" type="text" required aria-describedby="lastName-error">
        <span id="lastName-error" class="error" aria-live="polite"></span>
      </div>
    </div>

    <div class="row">
      <label for="firstName">First name</label>
      <div class="form-group">
        <input id="firstName" name="firstName" type="text" required aria-describedby="firstName-error">
        <span id="firstName-error" class="error" aria-live="polite"></span>
      </div>
    </div>

    <div class="row">
      <label for="course">Course</label>
      <select id="course" name="course">
        <option value="web">Web Programming</option>
        <option value="db">Databases</option>
        <option value="net">Networks</option>
        <option value="algo">Algorithms</option>
      </select>
    </div>

    <div class="row">
      <label for="email">Email</label>
      <div class="form-group">
        <input id="email" name="email" type="email" aria-describedby="email-error">
        <span id="email-error" class="error" aria-live="polite"></span>
      </div>
    </div>

    <div class="actions">
      <button type="submit" class="primary">Submit</button>
      <button type="reset">Reset</button>
      <a href="index.html" style="margin-left:auto; align-self:center; text-decoration:none; color:#2b7cff">Back to attendance</a>
    </div>

    <p class="note">Student ID: digits only. Max length 10. This validation happens client-side; always validate server-side too.</p>
  </form>

  <script>
    (function(){
      const form = document.getElementById('student-form');
      const sid = document.getElementById('sid');
      const sidError = document.getElementById('sid-error');
      const lastName = document.getElementById('lastName');
      const lastNameError = document.getElementById('lastName-error');
      const firstName = document.getElementById('firstName');
      const firstNameError = document.getElementById('firstName-error');
      const email = document.getElementById('email');
      const emailError = document.getElementById('email-error');

      // Validation functions
      function validateStudentID(value) {
        if (!value || value.trim() === '') {
          return 'Student ID is required';
        }
        if (!/^\d+$/.test(value)) {
          return 'Student ID must contain only numbers';
        }
        return '';
      }

      function validateName(value, fieldName) {
        if (!value || value.trim() === '') {
          return fieldName + ' is required';
        }
        if (!/^[a-zA-Z\s'-]+$/.test(value)) {
          return fieldName + ' must contain only letters';
        }
        return '';
      }

      function validateEmail(value) {
        if (!value || value.trim() === '') {
          return ''; // Email is optional
        }
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(value)) {
          return 'Please enter a valid email address (e.g., name@example.com)';
        }
        return '';
      }

      // Student ID validation
      sid.addEventListener('input', function(e){
        const before = sid.value;
        const cleaned = before.replace(/\D+/g, '');
        if(cleaned !== before){
          const selection = sid.selectionStart - (before.length - cleaned.length);
          sid.value = cleaned;
          const pos = Math.max(0, Math.min(cleaned.length, selection));
          sid.setSelectionRange(pos, pos);
        }
        sidError.textContent = '';
      });

      sid.addEventListener('blur', function() {
        const error = validateStudentID(sid.value);
        sidError.textContent = error;
      });

      // Last Name validation
      lastName.addEventListener('blur', function() {
        const error = validateName(lastName.value, 'Last name');
        lastNameError.textContent = error;
      });

      // First Name validation
      firstName.addEventListener('blur', function() {
        const error = validateName(firstName.value, 'First name');
        firstNameError.textContent = error;
      });

      // Email validation
      email.addEventListener('blur', function() {
        const error = validateEmail(email.value);
        emailError.textContent = error;
      });

      // Form submission validation
      form.addEventListener('submit', function(e){
        e.preventDefault();
        
        let hasErrors = false;
        
        // Validate Student ID
        const sidErr = validateStudentID(sid.value);
        sidError.textContent = sidErr;
        if (sidErr) {
          hasErrors = true;
          sid.focus();
        }
        
        // Validate Last Name
        const lastNameErr = validateName(lastName.value, 'Last name');
        lastNameError.textContent = lastNameErr;
        if (lastNameErr) {
          hasErrors = true;
          if (!sidErr) lastName.focus();
        }
        
        // Validate First Name
        const firstNameErr = validateName(firstName.value, 'First name');
        firstNameError.textContent = firstNameErr;
        if (firstNameErr) {
          hasErrors = true;
          if (!sidErr && !lastNameErr) firstName.focus();
        }
        
        // Validate Email
        const emailErr = validateEmail(email.value);
        emailError.textContent = emailErr;
        if (emailErr) {
          hasErrors = true;
          if (!sidErr && !lastNameErr && !firstNameErr) email.focus();
        }
        
        // If there are errors, prevent submission
        if (hasErrors) {
          return false;
        }
        
        // Get form data
        const formData = {
          id: sid.value,
          lastName: lastName.value,
          firstName: firstName.value,
          course: document.getElementById('course').value,
          email: email.value
        };
        
        // Save to localStorage
        let students = JSON.parse(localStorage.getItem('students') || '[]');
        students.push(formData);
        localStorage.setItem('students', JSON.stringify(students));
        
        // Show success message
        alert('Student added successfully!');
        form.reset();
        sidError.textContent = '';
        lastNameError.textContent = '';
        firstNameError.textContent = '';
        emailError.textContent = '';
        
        // Optional: Redirect to attendance list
        window.location.href = 'index.html';
      });

      form.addEventListener('reset', function(){
        setTimeout(()=> {
          sidError.textContent = '';
          lastNameError.textContent = '';
          firstNameError.textContent = '';
          emailError.textContent = '';
        }, 0);
      });
    })();
  </script>
</body>
</html>